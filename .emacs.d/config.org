* General configuration

#+begin_src emacs-lisp
(setq user-full-name "Eric J. Berquist"
      user-mail-address "eric.berquist@gmail.com")

(add-to-list 'load-path "~/.emacs.d/lisp/")

;; took some tricks from http://www.aaronbedra.com/emacs.d/

;; What's the difference between setq and setq-default? Seems usage
;; here is rather inconsistent. TODO
;; See here: http://stackoverflow.com/questions/18172728/the-difference-between-setq-and-setq-default-in-emacs-lisp

;; http://stackoverflow.com/questions/3281581/how-to-word-wrap-in-emacs
;; http://stackoverflow.com/questions/12989072/showing-continuation-lines-in-emacs-in-a-text-terminal
(setq-default transient-mark-mode t
              visual-line-mode t
              truncate-lines nil
              line-number-mode t
              column-number-mode t
              cursor-type 'box)

;; Enable maximum syntax highlighting wherever possible.
(setq global-font-lock-mode t
      font-lock-maximum-decoration t)

;; Bells are annoying, stop ringing!
(setq-default visible-bell nil
              audible-bell nil
              ring-bell-function 'ignore)

;; 'y' is two characters less than 'yes'.
;; 'defalias' or 'fset'?
(defalias 'yes-or-no-p 'y-or-n-p)

;; death to tabs, tabs are evil
(setq-default indent-tabs-mode nil
              tab-width 4)

;; Automatically reload buffers when their files change, and make sure
;; to check on the version control status every now and then.
(global-auto-revert-mode t)
;; TODO Turns out this is *extremely* irritating and moves the mark
;; every time the buffer refreshes!
;; (setq-default auto-revert-check-vc-info t)

;; What platform are we on? darwin, gnu/linux are the most likely
;; answers.
(defvar system-type-as-string (prin1-to-string system-type))
(defun sys () system-type-as-string)

;; Set the path properly on OS X.
(use-package exec-path-from-shell)
(when (memq window-system '(mac ns))
  (exec-path-from-shell-initialize))
  ;; (use-package exec-path-from-shell
  ;;   :config
  ;;   (exec-path-from-shell-initialize)))
#+end_src

* Backups/autosaving

#+begin_src emacs-lisp
;; let's live on the edge and disable backup and autosave
(setq backup-inhibited t
      auto-save-default nil
      create-lockfiles nil
      make-backup-files nil
      )

;; (setq backup-directory-alist `(("." . "~/.saves")))
;; (setq backup-by-copying t)
;; (setq tramp-auto-save-directory "~/.saves")

;; Put autosave files (ie #foo#) and backup files (ie foo~) in ~/.emacs.d/.
;; (custom-set-variables
;;  ‘(auto-save-file-name-transforms ‘((“.*” “~/.saves/\\1″ t)))
;;   ‘(backup-directory-alist ‘((“.*” . “~/.saves/”))))
#+end_src

However, I would like to save my loaded buffers.

#+BEGIN_SRC emacs-lisp
;; (desktop-save-mode 1)
#+END_SRC

* Disable popup boxes

#+begin_src emacs-lisp
(defadvice yes-or-no-p (around prevent-dialog activate)
  "Prevent yes-or-no-p from activating a dialog"
  (let ((use-dialog-box nil))
    ad-do-it))
(defadvice y-or-n-p (around prevent-dialog-yorn activate)
  "Prevent y-or-n-p from activating a dialog"
  (let ((use-dialog-box nil))
    ad-do-it))
#+end_src

* Ido and searching

Some handy tips for [[https://www.masteringemacs.org/article/introduction-to-ido-mode]["Interactively DO things."]]

#+begin_src emacs-lisp
(use-package ido
  :config
  (setq ido-enable-flex-matching t
        ido-everywhere t
        ;; wow, that *is* annoying!
        ido-use-filename-at-point nil
        ido-use-url-at-point nil)
  :init
  (ido-mode t)
  )
#+end_src

We don't need to =(use-package swiper)= thanks to the ivy one? This is a confusing mess.

#+BEGIN_SRC emacs-lisp
(use-package ivy
  :disabled t
  :config
  (setq 
   ivy-use-virtual-buffers t
   ivy-count-format "(%d/%d) "
   )
  :init
  (ivy-mode 1)
  )

;; (global-set-key (kbd "C-s") 'swiper)
#+END_SRC

Source for anzu can be found [[https://github.com/syohex/emacs-anzu][here]].

#+BEGIN_SRC emacs-lisp
(use-package anzu
  ;; Unncessary since anzu comes with a variable!
  ;; :diminish ""
  :config
  (setq
   anzu-mode-lighter ""
   )
  :init
  (global-anzu-mode 1)
  )
#+END_SRC

Some of my computers have [[https://github.com/BurntSushi/ripgrep][ripgrep]] installed. Use =M-x ripgrep-regexp= to activate.

#+BEGIN_SRC emacs-lisp
(use-package ripgrep)
#+END_SRC

* Parens/whitespace/indentation

See http://www.lunaryorn.com/2015/01/06/my-emacs-configuration-with-use-package.html.

#+begin_src emacs-lisp
(use-package mic-paren
  :init
  (paren-activate)
  )

(use-package whitespace
  :init
  (setq global-whitespace-mode nil)
  :config
  (setq
   ;; use the fill-column value
   whitespace-line-column nil
   whitespace-display-mappings
   '((space-mark   ?\ [?\u00B7] [?.])
     (space-mark   ?\xA0 [?\u00A4] [?_])
     (newline-mark ?\n [?\u21B5 ?\n]
                   [172 10] [?\u00AF ?\n]) ;; downwards arrow, ..., overscore
     (tab-mark     ?\t [9655 9]))
   whitespace-style
   '(face
     trailing
     tabs
     ;; tab-mark
     ;; spaces
     ;; space-mark
     ;; lines-tail
     ;; newline
     ;; newline-mark
     ;; empty
     indentation::tab
     indentation::space
     indentation
     space-after-tab::tab
     space-after-tab::space
     space-after-tab
     space-before-tab::tab
     space-before-tab::space
     space-before-tab)
   )
  (add-hook 'makefile-mode-hook 'whitespace-mode)
  (add-hook 'python-mode-hook 'whitespace-mode)
  )

(use-package dtrt-indent
  :init
  (dtrt-indent-mode 1)
  )

(use-package unfill)

;; Always place a newline at the end of files, like nano does by
;; default.
(setq require-final-newline t)
#+end_src

Other paren settings; which package(s) do they belong to?

#+BEGIN_SRC emacs-lisp
(setq paren-delay nil)
(setq paren-highlight-at-point t)
(setq paren-highlight-offscreen t)
#+END_SRC

* Keybindings

Used to have stuff for ='comment-or-uncomment-region=, ='comment-region=, and ='uncomment-region= here, but =M-;= calls ='comment-dwim=, which is what you really want.

#+begin_src emacs-lisp
;; To reduce errors. Was: 'buffer-menu
(global-set-key (kbd "C-x C-b") 'switch-to-buffer)
;; Was: 'ido-switch-buffer
(global-set-key (kbd "C-x b") 'list-buffers)
(global-set-key (kbd "C-c b") 'switch-to-previous-buffer)

(global-set-key (kbd "C-+") 'text-scale-increase)
(global-set-key (kbd "C--") 'text-scale-decrease)

(global-set-key (kbd "C-x C-h") 'replace-string)
#+end_src

* Theming and window shaping

#+begin_src emacs-lisp
(add-to-list 'custom-theme-load-path "~/.emacs.d/themes")
(load-theme 'wombat2 t)
;; (load-theme 'abyss t)
;; (load-theme 'punpun-dark t)
;; (load-theme 'quasi-monochrome t)
;; (load-theme 'gotham t)

;; Other themes I like to have installed: monochrome-theme plan9-theme
;; abyss-theme lush-theme punpun-theme (punpun-light, punpun-dark)
;; gotham-theme quasi-monochrome-theme

(when window-system
  (if (eq system-type 'gnu/linux)
      (and (set-face-attribute 'default nil :font "DejaVu Sans Mono-11")
           (set-frame-font "DejaVu Sans Mono-11")))
  (if (eq system-type 'darwin)
      (and (set-face-attribute 'default nil :font "Panic Sans-11")
           (set-frame-font "Panic Sans-11"))))
;; How can I set fallback fonts if these aren't installed?
;; Or just try from a list?

;; If we're windowed, set the transparency
;; Usage: (set-frame-parameter (selected-frame) 'alpha '(<active> [<inactive>]))
;; (set-frame-parameter (selected-frame) 'alpha '(100 100))
;; (add-to-list 'default-frame-alist '(alpha 100 100))

;; If we're windowed, set the frame size.
(when (display-graphic-p)
  ;; 11-inch MacBook Air
  (if (eq system-type 'darwin)
      (set-frame-size (selected-frame) 191 55)))

(setq-default indicate-empty-lines t)
(when (not indicate-empty-lines)
  (toggle-indicate-empty-lines))
#+end_src

** line numbers

Taken from https://www.emacswiki.org/emacs/LineNumbers:

#+BEGIN_QUOTE
Here’s a better approach. Every buffer has it’s own format variable and the separator use the mode-line face.
#+END_QUOTE

#+BEGIN_SRC emacs-lisp
(use-package linum)

(unless window-system
  (add-hook 'linum-before-numbering-hook
            (lambda ()
              (setq-local linum-format-fmt
                          (let ((w (length (number-to-string
                                            (count-lines (point-min) (point-max))))))
                            (concat "%" (number-to-string w) "d"))))))

(defun linum-format-func (line)
  (concat
   (propertize (format linum-format-fmt line) 'face 'linum)
   (propertize " " 'face 'mode-line)))

(unless window-system
  (setq linum-format 'linum-format-func))

(use-package hlinum
  :disabled t
  :config
  (setq linum-highlight-in-all-buffersp t)
  :init
  (hlinum-activate)
  )
#+END_SRC

* Spelling

=C-;= to try and correct a misspelled word on a line.

#+begin_src emacs-lisp
(setq flyspell-issue-welcome-flag nil)
(setq flyspell-mode-line-string " FlyS")

;; These are the modes flyspell should be enabled for.
(dolist (hook '(text-mode-hook))
  (add-hook hook (lambda () (flyspell-mode 1))))
(dolist (hook '(change-log-mode-hook
                log-edit-mode-hook))
  (add-hook hook (lambda () (flyspell-mode -1))))

;; Don't enable flyspell for programming-type modes.
;; (dolist (mode '(emacs-lisp-mode-hook
;;                 inferior-lisp-mode-hook
;;                 python-mode-hook))
;;   (add-hook mode
;;             '(lambda ()
;;                (flyspell-prog-mode))))

(global-set-key (kbd "<f8>") 'ispell-word) ;; built-in binding is M-$, ew
(global-set-key (kbd "C-S-<f8>") 'flyspell-mode)
(global-set-key (kbd "C-M-<f8>") 'flyspell-buffer)
(global-set-key (kbd "C-<f8>") 'flyspell-check-previous-highlighted-word)
(defun flyspell-check-next-highlighted-word ()
  "Custom function to spell check next highlighted word"
  (interactive)
  (flyspell-goto-next-error)
  (ispell-word)
  )
(global-set-key (kbd "M-<f8>") 'flyspell-check-next-highlighted-word)
#+end_src

** word count

#+BEGIN_SRC emacs-lisp
(use-package wc-mode
  :bind (("C-c w" . wc-mode))
  )
#+END_SRC

* Flycheck

** General

TODO add LaTex

#+begin_src emacs-lisp
(use-package flycheck
  :init
  (setq flycheck-check-syntax-automatically
        '(mode-enabled
          new-line
          save
          idle-change)
        flycheck-idle-change-delay 0.5)
  (add-hook 'cython-mode-hook 'flycheck-mode)
  (add-hook 'sh-mode-hook 'flycheck-mode)
  )
#+end_src

** checkbashisms

For this to work, =checkbashisms= needs to be available on the =$PATH=:

#+begin_src sh
yaourt -S checkbashisms # Arch Linux, from AUR
brew install checkbashisms # Mac OS X, from Homebrew
sudo apt-get install devscripts # Debian/Ubuntu, official
sudo yum install rpmdevtools # Red Hat/CentOS
sudo pkg install checkbashisms # FreeBSD
#+end_src

#+begin_src emacs-lisp
(use-package flycheck-checkbashisms
  :config
  (flycheck-checkbashisms-setup)
  (setq
   ;; Check 'echo -n' usage
   flycheck-checkbashisms-newline t
   flycheck-checkbashisms-posix t
   ))
#+end_src

* Git/version control

** General

#+BEGIN_SRC emacs-lisp
;; Even though VC systems (at least git) commit the symbolic link
;; pointer itself, and not the file it's pointing to, I want to edit
;; the file.
(setq vc-follow-symlinks t)
#+END_SRC

** Git

- [[https://magit.vc/manual/magit/Getting-started.html][magit: Getting Started]]

#+BEGIN_SRC emacs-lisp
(use-package git-commit
  :init
  (global-git-commit-mode)
  )
(use-package gitconfig-mode)
(use-package gitignore-mode)
(use-package magit
  ;; "Getting started" uses C-x g, which is also undefined.
  :bind (("C-c m" . magit-status))
  )
(use-package magit-svn
  :config
  (add-hook 'magit-mode-hook 'magit-svn-mode)
  )
#+END_SRC

Not using =git-gutter= right now, but if I did...

#+BEGIN_SRC emacs-lisp
(setq git-gutter:handled-backends (quote (git svn hg bzr)))
(setq git-gutter:hide-gutter t)
#+END_SRC

* Pandoc

#+begin_src emacs-lisp
(use-package pandoc-mode
  :config
  (add-hook 'latex-mode-hook 'pandoc-mode)
  (add-hook 'LaTeX-mode-hook 'pandoc-mode)
  (add-hook 'pandoc-mode-hook 'pandoc-load-default-settings)
  )
#+end_src

* Org

#+begin_src emacs-lisp
;; http://orgmode.org/manual/Code-evaluation-security.html
(defun my-org-confirm-babel-evaluate (lang body)
  (not (string= lang "latex")))

(use-package org
  :bind (("C-c l" . org-store-link)
         ("C-c a" . org-agenda)
         ("C-c c" . org-capture)
         ("C-c b" . org-iswitchb))
  :config
  (setq org-directory "~/Dropbox/Notes"
        org-agenda-files '("~/Dropbox/Notes"
                           "~/Dropbox/research/lab_notebook")
        org-log-done 'time
        org-log-done-with-time t
        org-closed-keep-when-no-todo t
        ;; http://superuser.com/questions/299886/linewrap-in-org-mode-of-emacs
        org-startup-truncated nil
        org-src-tab-acts-natively t
        org-babel-python-command "ipython"
        org-export-backends (quote (ascii html icalendar latex md))
        org-export-dispatch-use-expert-ui t
        org-export-with-smart-quotes t
        org-image-actual-width nil
        org-edit-src-content-indentation 0
        org-src-fontify-natively t
        org-src-tab-acts-natively t
        org-latex-create-formula-image-program 'imagemagick
        ;; http://stackoverflow.com/questions/17239273/org-mode-buffer-latex-syntax-highlighting
        org-highlight-latex-and-relatex '(latex script entities)
        org-html-with-latex (quote mathjax)
        org-latex-inline-image-rules '(("file" . "\\.\\(pdf\\|jpeg\\|jpg\\|png\\|ps\\|eps\\|tikz\\|pgf\\|svg\\|gif\\)\\'"))
        org-confirm-babel-evaluate 'my-org-confirm-babel-evaluate
        org-latex-hyperref-template "\\hypersetup{\n pdfauthor={%a},\n pdftitle={%t},\n pdfkeywords={%k},\n pdfsubject={%d},\n pdfcreator={%c}, \n pdflang={%L}, \n colorlinks=true, \n linkcolor=MidnightBlue, \n citecolor=MidnightBlue, \n urlcolor=MidnightBlue}\n"
        )
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((emacs-lisp . t)
     (sh . t)
     (C . t)
     ;; How to handle C++?
     ;; (C++ . t)
     (latex . t)
     (python . t)))
  (add-to-list 'org-latex-packages-alist '("" "braket" t))
  (add-to-list 'org-latex-packages-alist '("usenames,dvipsnames" "xcolor" nil))
  ;; http://joat-programmer.blogspot.com/2013/07/org-mode-version-8-and-pdf-export-with.html
  ;; You need to install pygments to use minted.
  (when (executable-find "pygmentize")
    ;; Add minted to the defaults packages to include when exporting.
    (add-to-list 'org-latex-packages-alist '("" "minted" nil))
    ;; Tell the latex export to use the minted package for source code
    ;; coloration.
    (setq org-latex-listings 'minted)
    ;; Let the exporter use the -shell-escape option to let latex
    ;; execute external programs.  This obviously and can be
    ;; dangerous to activate!
    (setq org-latex-minted-options
          '(("mathescape" "true")
            ("linenos" "true")
            ("numbersep" "5pt")
            ("frame" "lines")
            ("framesep" "2mm"))))
  (setq org-latex-pdf-process
        '("latexmk -xelatex -shell-escape -interaction=batchmode -output-directory=%o %f"))
  :init
  )
(use-package htmlize)
(use-package ox-gfm)
(use-package ox-pandoc)
(use-package ox-twbs)
#+end_src

Additional things of interest might be found in https://github.com/xiaohanyu/oh-my-emacs/blob/master/core/ome-org.org.

Every time an Org buffer is saved, automatically export it to HTML. Taken from https://www.reddit.com/r/emacs/comments/4golh1/how_to_auto_export_html_when_saving_in_orgmode/.

#+BEGIN_SRC emacs-lisp
(defun org-mode-export-hook ()
  (add-hook 'after-save-hook 'org-html-export-to-html t t))
(add-hook 'org-mode-hook #'org-mode-export-hook)
#+END_SRC

A function to toggle this auto-HTML-export behavior. Does this play nice with the function above?

#+BEGIN_SRC emacs-lisp
(defun toggle-org-html-export-on-save ()
  (interactive)
  (if (memq 'org-html-export-to-html after-save-hook)
      (progn
        (remove-hook 'after-save-hook 'org-html-export-to-html t)
        (message "Disabled org html export on save for current buffer..."))
    (add-hook 'after-save-hook 'org-html-export-to-html nil t)
    (message "Enabled org html export on save for current buffer...")))
#+END_SRC

* CSS

#+begin_src emacs-lisp
(use-package rainbow-mode
  :disabled t)
;; (defun my-css-mode-hook ()
;;   (rainbow-mode t))
;; (add-hook 'css-mode-hook 'my-css-mode-hook)

;; (define-globalized-minor-mode my-global-rainbow-mode rainbow-mode
;;   (lambda () (rainbow-mode 1)))

;; (my-global-rainbow-mode 1)
(setq my-global-rainbow-mode nil)
#+end_src

* Compilation

Taken from https://emacs.stackexchange.com/questions/62/hide-compilation-window#110.

#+BEGIN_SRC emacs-lisp
(add-hook 'compilation-finish-functions
          (lambda (buf strg)
            (let ((win (get-buffer-window buf 'visible)))
              (when win (delete-window win)))))
#+END_SRC

* C/C++

#+begin_src emacs-lisp
(setq auto-mode-alist
     (append '(("\\.C$" . c++-mode)
               ("\\.cc$" . c++-mode)
               ("\\.cpp$" . c++-mode)
               ("\\.c$" . c-mode)
               ("\\.h$" . c++-mode)
               ("\\.hh$" . c++-mode)
               ("\\.hpp$" . c++-mode)
               ) auto-mode-alist))
#+end_src

These are valid for all C-style modes (I think).

#+BEGIN_SRC emacs-lisp
(setq c-basic-offset 4)
(setq c-default-style
      (quote
       ((java-mode . "java")
        (awk-mode . "awk")
        (other . "k&r"))))
(setq c-doc-comment-style
      (quote
       ((c-mode . javadoc)
        (java-mode . javadoc)
        (pike-mode . autodoc))))
#+END_SRC

#+BEGIN_SRC emacs-lisp
(use-package clang-format
  :bind (("C-M-<tab>" . clang-format-region))
  )
#+END_SRC

** TODO What's the difference between =c++-mode= and =cc-mode=?

** ISPC

Taken from an [[https://github.com/ispc/ispc/issues/1105][ISPC GitHub issue]].

#+begin_src emacs-lisp
(defun add-ispc-keywords()
  "adds uniform and varying keywords for c and c++ modes"
  (font-lock-add-keywords nil
                          '(
                            ("\\<\\(uniform\\)" . 'font-lock-keyword-face)
                            ("\\<\\(varying\\)" . 'font-lock-keyword-face)
                            ("\\<\\(export\\)" . 'font-lock-keyword-face)
                            )
                          )
  )

(add-hook 'c++-mode-hook 'add-ispc-keywords)
(add-to-list 'auto-mode-alist '("\\.ispc$" . c++-mode))
(add-to-list 'auto-mode-alist '("\\.isph$" . c++-mode))

#+end_src

* Makefiles

#+begin_src emacs-lisp
(setq auto-mode-alist
      (append '(("Makefile*\\'" . makefile-mode)
                ("makefile*\\'" . makefile-mode)
                ) auto-mode-alist))
#+end_src

* FORTRAN

#+begin_src emacs-lisp
;; These might already be defaults, but it doesn't hurt.
(setq auto-mode-alist
      (append '(("\\.f\\'"   . fortran-mode)
                ("\\.F\\'"   . fortran-mode)
                ("\\.for\\'" . fortran-mode)
                ("\\.f90\\'" . f90-mode)
                ("\\.F90\\'" . f90-mode)
                ("\\.f95\\'" . f90-mode)
                ("\\.f03\\'" . f90-mode)
                ("\\.f08\\'" . f90-mode)
                ) auto-mode-alist))

(setq fortran-comment-region "C")
#+end_src

* PKGBUILDs

#+begin_src emacs-lisp
(use-package pkgbuild-mode
  :mode
  (("/PKGBUILD/" . pkgbuild-mode))
  )
#+end_src

* systemd

#+begin_src emacs-lisp
(use-package systemd)
#+end_src

* LaTeX

#+begin_src emacs-lisp
;; (use-package auctex-latexmk) 
;; (auctex-latexmk-setup)
#+end_src

* Python

#+begin_src emacs-lisp
;; The package is "python" but the mode is "python-mode":
(use-package python
  :mode (("\\.ipy\\'" . python-mode))
  :interpreter ("ipython" . python-mode)
  )

;; Use pyflakes instead of flake8 or pylint for syntax checking.
;; I think stuffing the setq under config activates this for Python.
(use-package flycheck-pyflakes
  :config
  ;; Don't disable these, in case pyflakes isn't available.
  ;; (add-to-list 'flycheck-disabled-checkers 'python-flake8)
  ;; (add-to-list 'flycheck-disabled-checkers 'python-pylint)
  ;; (add-to-list 'flycheck-disabled-checkers 'python-pycompile)
  (setq flycheck-pylintrc "~/.pylintrc")
)
#+end_src

** Cython

#+BEGIN_SRC emacs-lisp
(use-package cython-mode)
(use-package flycheck-cython)
#+END_SRC

* Markdown

#+BEGIN_SRC emacs-lisp
(defun get-string-from-file (file-path)
  "Return file-path's file content."
  (with-temp-buffer
    (insert-file-contents file-path)
    (buffer-string)))
#+END_SRC

#+begin_src emacs-lisp
(use-package markdown-mode
  :mode
  (
   ;; ("\\.text\\'" . markdown-mode)
   ;; ("\\.txt\\'" . markdown-mode)
   ("\\.markdown\\'" . markdown-mode)
   ("\\.mdown\\'" . markdown-mode)
   ("\\.md\\'" . gfm-mode)
   )
  :config
  (add-hook 'markdown-mode-hook 'pandoc-mode)
  ;; (add-hook 'markdown-mode-hook 'markdown-preview-mode)
  ;; This currently creates a buffer with the *.html contents. How to
  ;; fix? TODO
  (add-hook 'markdown-mode-hook
            (lambda ()
              (add-hook 'after-save-hook 'markdown-export t :local)))
  :init
  (setq
   ;; my-markdown-header-string (get-string-from-file (expand-file-name "file://${HOME}/.emacs.d/mathjax.html"))
   markdown-content-type "application/xhtml+xml"
   markdown-coding-system "utf-8"
   markdown-command "pandoc --css=file://${HOME}/.emacs.d/github-pandoc.css --from=markdown_github --to=html5 --smart --mathjax='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML-full' --highlight-style=pygments --standalone"
   ;; markdown-css-paths '("file://${HOME}/.emacs.d/github-pandoc.css")
   markdown-enable-math t
   markdown-fontify-code-blocks-natively t
   markdown-hide-markup nil
   markdown-hide-urls nil
   markdown-link-space-sub-char "-"
   ;; markdown-preview-style "file://${HOME}/.emacs.d/github-markdown.css"
   ;; markdown-xhtml-header-content (format "%s" my-markdown-header-string)
   )
  )
#+end_src

# ** Markdown Preview

# #+BEGIN_SRC emacs-lisp
# (use-package markdown-preview-mode
#   :config
#   ;; The MathJax CDN is no longer active. Use the one that Stack Exchange calls.
#   ;; (add-to-list 'markdown-preview-javascript 
#   ;;              '("http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML" . async))
#   (add-to-list 'markdown-preview-javascript
#                '("https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML-full" . async))
#   )
# #+END_SRC

* deft

Taken conveniently from [[http://jblevins.org/projects/deft/][Jason Blevins' website]].

#+begin_src emacs-lisp
(use-package deft
  :config
  (progn
    (setq
     ;; "${HOME}/Dropbox/Notes" doesn't work, why is that?
     deft-directory "~/Dropbox/Notes"
     deft-extensions '("txt" "text" "utf8" "taskpaper" "md" "markdown" "org" "tex")
     deft-time-format " %Y-%m-%d %H:%M:%S"
     deft-recursive t
     deft-use-filename-as-title t)
    (global-set-key [f9] 'deft))
  )
#+end_src

* CMake

This section needs to come after the Markdown section so that CMake files get recognized properly.

#+begin_src emacs-lisp
(use-package cmake-mode
  :mode
  (("CMakeLists\\.txt\\'" . cmake-mode)
   ("CMakeCache\\.txt\\'" . cmake-mode)
   ("\\.cmake\\'" . cmake-mode))
  :config
  (setq cmake-tab-width 4)
  )
#+end_src

* EditorConfig

http://editorconfig.org/

TODO How to make this take precedence over =dtrt-indent=?

#+BEGIN_SRC emacs-lisp
(use-package editorconfig
  :diminish ""
  :init
  (add-hook 'prog-mode-hook (editorconfig-mode 1))
  (add-hook 'text-mode-hook (editorconfig-mode 1)))
#+END_SRC

* Julia

#+BEGIN_SRC emacs-lisp
(use-package julia-mode)
#+END_SRC

* Chapel

#+BEGIN_SRC emacs-lisp
(use-package chapel-mode)
#+END_SRC

* Lua

#+BEGIN_SRC emacs-lisp
(use-package lua-mode)
#+END_SRC

* Ruby

#+BEGIN_SRC emacs-lisp
(setq ruby-indent-level 4)
#+END_SRC

* YAML

#+BEGIN_SRC emacs-lisp
(use-package yaml-mode)
#+END_SRC

* JSON

#+BEGIN_SRC emacs-lisp
(use-package json-mode)
#+END_SRC

* MATLAB/Octave

#+BEGIN_SRC emacs-lisp
;; Don't use matlab-mode.
;; (use-package matlab-mode)
;; I don't write Objective-C.
(assq-delete-all "\\.m\\'" auto-mode-alist)
(setq auto-mode-alist 
      (cons '("\\.m\\'" . octave-mode) auto-mode-alist))
#+END_SRC

* CUDA

#+BEGIN_SRC emacs-lisp
(use-package cuda-mode)
#+END_SRC

* docview

#+begin_src emacs-lisp
(use-package doc-view
  :disabled t
  :config
  ;; paging up and down globally
  ;; (fset 'doc-prev "\C-xo\C-x[\C-xo")
  ;; (fset 'doc-next "\C-xo\C-x]\C-xo")
  ;; (global-set-key (kbd "M-[") 'doc-prev)
  ;; (global-set-key (kbd "M-]") 'doc-next)
  (define-key doc-view-mode-map (kbd "M-[") 'doc-view-previous-page)
  (define-key doc-view-mode-map (kbd "M-]") 'doc-view-next-page)
  ;; always refresh when the contents change
  )
#+end_src
