---
# Ubuntu:
#
#   curl -sS https://downloads.1password.com/linux/keys/1password.asc | sudo gpg --dearmor --output /usr/share/keyrings/1password-archive-keyring.gpg
#   echo 'deb [arch=amd64 signed-by=/usr/share/keyrings/1password-archive-keyring.gpg] https://downloads.1password.com/linux/debian/amd64 stable main' | sudo tee /etc/apt/sources.list.d/1password.list
#   sudo mkdir -p /etc/debsig/policies/AC2D62742012EA22/
#   curl -sS https://downloads.1password.com/linux/debian/debsig/1password.pol | sudo tee /etc/debsig/policies/AC2D62742012EA22/1password.pol
#   sudo mkdir -p /usr/share/debsig/keyrings/AC2D62742012EA22
#   curl -sS https://downloads.1password.com/linux/keys/1password.asc | sudo gpg --dearmor --output /usr/share/debsig/keyrings/AC2D62742012EA22/debsig.gpg
#   sudo apt update && sudo apt install 1password
#
# - name: install 1Password on Debian-based systems
#   hosts: all
#   gather_facts: false
#   tasks:
#     - name: download 1Password package signing key
#       get_url:
#         url: https://downloads.1password.com/linux/keys/1password.asc
#         dest: /tmp/1password.asc
#       when: ansible_distribution == "Ubuntu" or ansible_distribution == "Pop!_OS"
#     - name: import 1Password package signing key
#       command:
#         cmd: 'gpg --dearmor --output /usr/share/keyrings/1password-archive-keyring.gpg /tmp/1password.asc'
#         creates: /usr/share/keyrings/1password-archive-keyring.gpg
#       when: ansible_distribution == "Ubuntu" or ansible_distribution == "Pop!_OS"
#     - name: add 1Password repository
#       when: ansible_distribution == "Ubuntu" or ansible_distribution == "Pop!_OS"

- name: install 1Password on Arch
  gather_facts: false
  hosts: all
  become_user: aur_builder
  roles:
    - kewlfft.aur
  pre_tasks:
    - setup:
        gather_subset:
          - distribution
      tags:
        - always
  tasks:
    - name: download 1Password package signing key
      get_url:
        url: https://downloads.1password.com/linux/keys/1password.asc
        dest: /tmp/1password.asc
      when: ansible_distribution == "Archlinux"
    - name: import 1Password package signing key
      command:
        cmd: 'gpg --import /tmp/1password.asc'
      when: ansible_distribution == "Archlinux"
    - name: install 1Password
      aur:
        name: 1password
      when: ansible_distribution == "Archlinux"
