##### Basic Usage #####

# First things first: Remap the prefix key to reduce conflicts with Emacs!
unbind C-b

# By default, we'll use the backtick as the prefix key.
set -g prefix '`' ; bind '`' send-prefix

# Don't run the login shell by default when we start.
set -g default-command "${SHELL}"

# Reload tmux config so we can pick up changes to this file without needing to restart tmux
bind r source-file ~/.tmux.conf \; display "Reloaded tmux configuration!"

# Index windows from 1, not 0, so they line up a little better
# with the order of the number keys on the keyboard
set -g base-index 1
setw -g pane-base-index 1

# Reduce the command delay time to something a bit shorter
set -sg escape-time 0
# set-option -sg escape-time 0
# Extend the repeat interval for repeatable commands (e.g., resize-pane)
set -sg repeat-time 1000
# Refresh the status bar every second.
set -g status-interval 1

# Default is 2000
set -g history-limit 100000

# When a smaller terminal connects to a tmux client, it shrinks to fit it.
# The clients attached with bigger displays see this constrained view.
# aggressive-resize makes it such that the window is only resized if the
# smaller client is actively looking at it.
setw -g aggressive-resize on

##### Mouse Support (or lack thereof) #####

# No mouse for you!
# (Note: turning on mouse support seems to make it impossible to use the
# mouse to copy text into the system clipboard. Surely there's a way
# around this if I ever feel like shaving that yak. -JW)
setw -g mode-mouse off
set -g mouse-select-pane off
set -g mouse-resize-pane off
set -g mouse-select-window off

##### Scrollback Navigation #####

# Use emacs-style navigation in Copy mode (which is also scrollback mode)
setw -g mode-keys emacs

##### Window/Pane Management #####

# Split windows more intuitively (except for the fact that tmux doesn't
# understand that a horizontal split means the pane should be split down the
# middle horizontally, and likewise for a vertical split).
bind | split-window -h # horizontal columns
bind - split-window -v # vertical rows

# # Navigate panes vim-style!
# bind h select-pane -L
# bind j select-pane -D
# bind k select-pane -U
# bind l select-pane -R

# # And windows too!
# bind -r C-l select-window -t :+
# bind -r C-h select-window -t :-

# # Quickly jump between two windows
# bind i last-window

# # Resizing panes
# bind -r H resize-pane -L 5
# bind -r J resize-pane -D 5
# bind -r K resize-pane -U 5
# bind -r L resize-pane -R 5

# Renumber windows
bind m command-prompt -p "move window to:" "move-window -t '%%'"

##### Colors #####
# Ensure we're using 256 colors
set -g default-terminal "screen-256color"

set-option -g set-titles on
set-option -g set-titles-string "#$(whoami)@#h: [#S] #T"

# Status bar
set -g status-fg white
set -g status-bg colour234

# Window list
setw -g window-status-fg green
setw -g window-status-bg default
setw -g window-status-attr dim
setw -g window-status-current-fg white
setw -g window-status-current-bg blue
setw -g window-status-current-attr bright

# Pane borders
set -g pane-border-fg default
set -g pane-border-bg default
set -g pane-active-border-fg green
set -g pane-active-border-bg blue

# Command line
set -g message-fg white
set -g message-bg red
set -g message-attr bright

# Status Bar Items
set -g status-position top
set -g status-utf8 on
set -g status-left-length 100
set -g status-left "#[fg=yellow]#I #[fg=green]#P #S #[fg=red]#W #[fg=blue]#T"
set -g status-right "#[fg=cyan]#H #[fg=yellow]%a %b %e %T"
set -g status-justify centre

# Monitor windows for activity
setw -g monitor-activity on
set -g visual-activity on

### Unused bits go below here...

# # Status bar has a dim gray background
# set-option -g status-bg colour234
# set-option -g status-fg colour255
# # Left shows the session name, in blue
# set-option -g status-left-bg default
# set-option -g status-left-fg colour74

# xclip support (commented as this often doesn't make sense on remote servers)
# bind C-c run "tmux save-buffer - / xclip -i -sel clipboard"
# bind C-v run "tmux set-buffer \"$(xclip -o -sel clipboard)\"; tmux paste-buffer"

# set up alias for turning on logging
# bind P pipe-pane -o "cat >>~/#W.log" \; display "Toggled logging to ~/#W.log"

# set up aliases for temporarily maximizing panes
# unbind Up
# bind Up new-window -d -n tmp \; swap-pane -s tmp.1 \; select-window -t tmp
# unbind Down
# bind Down last-window \; swap-pane -s tmp.1 \; kill-window -t tmp

# Are we running on a Mac? Use some extra options.
if-shell 'test "$(uname)" = "Darwin"' 'source ~/.tmux-osx.conf'